var app={config:{homeImages:["images/architecture.3.jpg","images/architecture.2.jpg","images/architecture.6.jpg","images/architecture.1.jpg","images/bridge.1.jpg"],bkgImagesDefault:"assets/img/bkg/default.jpg",bkgImagesInterval:7500,bkgImagesDuration:300,musicPlayer:!0,musicPlayerAutoplay:!0,musicPath:"music",pagesJsonUrl:"data/pages.json",playlistJsonUrl:"data/music.json",collectionJsonUrl:"data/collection_:id.json",blogJsonUrl:"data/blog_:id.json",commentsJsonUrl:"data/comments_:id.json",commentsPostUrl:"#",
galleryJsonUrl:"data/gallery_:id.json"},views:{},models:{},router:null,collections:{},vars:{sizeBase:7},utils:{}};$.browser.msie&&9>parseInt($.browser.version)&&(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;c<d;c++)if(this[c]===a)return c;return-1});
app.utils.whichTransitionEvent=function(){var a,b=document.createElement("fakeelement"),c={transition:"transitionEnd",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(b.style[a]!==void 0)return c[a]};
app.utils.fadeImage=function(a,b,c){a.imgpreload({each:function(){$(this).css({opacity:0,visibility:"visible"}).transition({opacity:1,duration:300,easing:"easeInOutQuart"},function(){typeof b==="function"&&b(this)})},all:function(){typeof c==="function"&&c(this)}})};app.utils.scrollbar=function(a){(!Modernizr.cssscrollbar||$.browser.msie)&&a.jScrollPane({verticalGutter:0,autoReinitialise:true,autoReinitialiseDelay:150})};
app.router=Backbone.Router.extend({routes:{"":"home",":id/post/:post_id/:post_url":"blogPost",":id/:page_url":"section"},initialize:function(){this.vars={};this.currentSection=null},home:function(){this.currentSection&&this.currentSection.close();this.currentSection=null;this.trigger("sectionSwitch")},blogPost:function(a,b){if(isFinite(a)){this.vars.id=a;this.vars.postId=b}if(app_pages.models.length==0)app_pages.on("reset",this.blogPost,this);else{var c=this,d=app_pages.get(this.vars.id).get("blog_id");
if(typeof app.vars.blogs==="undefined")app.vars.blogs={};if(typeof app.vars.blogs[d]==="undefined"){app.vars.blogs[d]=new app.collections.blog(null,{id:d});app.vars.blogs[d].on("reset",this.blogPost,this);app.vars.blogs[d].fetch()}else{var e=app.vars.blogs[d].get(this.vars.postId),d=function(){c.currentSection=new app.views.sectionBlogPost({model:e});c.currentSection.on("close",function(){this.close()}).on("sectionClosed",function(){c.currentSection=null;c.trigger("sectionClosed")});c.trigger("sectionSwitch")};
if(this.currentSection){this.currentSection.off("sectionClosed");this.currentSection.on("sectionClosed",d,this);this.currentSection.trigger("close")}else d()}}},section:function(a){if(isFinite(a)){this.vars.id=a;this.vars.postId=null}if(app_pages.models.length==0)app_pages.on("reset",this.section,this);else{var b=this,c=app_pages.get(this.vars.id),a=c.get("type"),d="section"+a.substr(0,1).toUpperCase()+a.substr(1).toLowerCase();if(app.views[d]&&this.currentSection!=c){a=function(){b.currentSection=
new app.views[d]({model:c});b.currentSection.on("close",function(){this.close()}).on("sectionClosed",function(){b.currentSection=null;b.trigger("sectionClosed")});b.trigger("sectionSwitch")};if(this.currentSection){this.currentSection.off("sectionClosed");this.currentSection.on("sectionClosed",a,this);this.currentSection.trigger("close")}else a()}}}});
app.views.main=Backbone.View.extend({el:"#container",initialize:function(){var a=this;this.els={};this.els.header=this.$("header");this.els.footer=this.$("footer");this.els.content=this.$("#content");this.els.icoFullScreen=this.$("#ico-fullscreen");this.els.homeClaim=this.$("#home-claim");this.views={};this.views.ico=new app.views.ico;this.views.bkg=new app.views.bkg;this.playerSetup();this.vars={};this.vars.stopFullScreen=false;app_router.on("sectionSwitch",function(){var b=a.els.homeClaim.css("opacity")==
0?false:true;app_router.currentSection?b&&a.els.homeClaim.transition({easing:"easeInOutQuint",duration:500,queue:false,opacity:0,left:-100},function(){$(this).css("display","none")}):a.els.homeClaim.css("display","block").transition({easing:"easeInOutQuint",duration:500,queue:false,opacity:1,left:35})},this);var b=parseInt(this.els.header.css("top")),c=parseInt(this.els.footer.css("bottom"));this.els.header.css({top:(this.els.header.height()+b)*-1});this.els.footer.css({bottom:(this.els.footer.height()+
c)*-1});this.fullscreen=false;this.els.icoFullScreen.bind("click",function(){a.toggleFullscreen()});$(window).bind("load",function(){setTimeout(function(){a.els.header.transition({top:b,duration:450,easing:"easeOutBack",queue:false},function(){a.views.header=new app.views.headerMenu({collection:app_pages})});a.els.footer.transition({bottom:c,duration:450,easing:"easeOutBack",queue:false})},1E3)})},playerSetup:function(){if(app.config.musicPlayer&&Modernizr.audio)this.views.musicPlayer=new app.views.footerPlayer({mainView:this,
collection:new app.collections.playlist})},toggleFullscreen:function(){this.views.ico.trigger("toggleFullscreen");if(!this.vars.stopFullScreen){this.vars.stopFullScreen=true;var a=this,b=this.fullscreen?$("#header-top").height()+1:this.els.header.height()*-1,c=this.fullscreen?$("#footer-bottom").height()+1:this.els.footer.height()*-1,d=a.fullscreen?1:0,e=a.fullscreen?450:550,f=a.fullscreen?"easeOutBack":"easeInExpo";this.trigger("toggleFullscreenStart");app_router.currentSection&&app_router.currentSection.trigger("toggleFullscreenStart");
if(this.fullscreen){var g=app.vars.sizeBase*16;this.els.content.transition({duration:e,easing:f,queue:false,top:g,bottom:g})}this.els.header.transition({top:b,opacity:d,duration:e,easing:f,queue:false},function(){if(a.fullscreen){a.fullscreen=!a.fullscreen;a.vars.stopFullScreen=false;a.trigger("toggleFullscreenEnd");app_router.currentSection&&app_router.currentSection.trigger("toggleFullscreenEnd")}else setTimeout(function(){var b=app.vars.sizeBase*5;a.els.content.transition({duration:400,easing:"easeOutQuart",
queue:false,top:b,bottom:b},function(){a.fullscreen=!a.fullscreen;a.vars.stopFullScreen=false;a.trigger("toggleFullscreenEnd");app_router.currentSection&&app_router.currentSection.trigger("toggleFullscreenEnd")})},400)});this.els.footer.transition({bottom:c,opacity:d,duration:e,easing:f,queue:false})}}});
app.views.bkg=Backbone.View.extend({initialize:function(){app_router.on("sectionSwitch",this.render,this);this.vars={};this.vars.interval=null},render:function(){var a=this,b;b=app_router.currentSection?app_router.currentSection.model.get("type"):"home";clearInterval(a.vars.interval);var c=function(b){if(typeof b!=="undefined"){if(b.constructor===Array)if(b.length>1){var e=0;$.backstretch(b[e],{speed:app.config.homeImagesDuration});a.vars.interval=setInterval(function(){e=e+1===app.config.homeImages.length?
0:e+1;$.backstretch(b[e],{speed:app.config.bkgImagesDuration})},app.config.bkgImagesInterval)}else c(b[0]);b.constructor===String&&$.backstretch(b,{speed:app.config.bkgImagesDuration})}else c(app.config.bkgImagesDefault)};switch(b){case "home":c(app.config.homeImages);break;default:b=app_router.currentSection.model.get("background");c(b)}}});
app.views.headerMenu=Backbone.View.extend({el:"header nav",initialize:function(){this.template=_.template($("#tmpl_header_menu").html());app_router.on("sectionSwitch",this.menuSel,this).on("sectionClosed",this.menuSel,this);this.on("headerMenuRendered",this.menuSel,this);this.collection.on("reset",this.render,this);this.collection.fetch()},menuSel:function(){var a=this.$el.find(".root > a");if(app_router.currentSection){var b=app_router.currentSection.model,c=b.get("parent_id");if(app_router.vars.postId){b=
app_pages.get(app_router.vars.id);c=b.get("parent_id")}for(;c;){b=app_pages.get(c);c=b.get(c)}b="header-menu-"+b.get("id");b=this.$el.find("#"+b);a.removeClass("selected");b.addClass("selected")}else a.removeClass("selected")},render:function(){var a=this,b=0,c=this.template({pages:this.collection.rootPages(),collection:this.collection}),d=$("#header-select"),e,f,g,h,j,i;_.each(this.collection.rootPages(),function(b){e=b.get("name");f=b.get("type");j=a.collection.subPages(b.get("id"));switch(f){case "home":g=
"#/";break;case "empty":g="javascript:void(0)";break;default:g="#/"+b.get("id")+"/"+b.get("name")}h=document.createElement("option");h.setAttribute("value",g);h.appendChild(document.createTextNode(e));d.append(h);if(j.length){i=document.createElement("optgroup");i.setAttribute("label",e);_.each(j,function(a){e=a.get("name");f=a.get("type");switch(f){case "home":g="#/";break;case "empty":g="javascript:void(0)";break;default:g="#/"+a.get("id")+"/"+a.get("name")}h=document.createElement("option");h.setAttribute("value",
g);h.appendChild(document.createTextNode(e));$(i).append(h)});d.append(i)}});d.on("change",function(){location.href=$(this).val()});this.$el.empty().append(c).find(".root > a").css({opacity:0,rotate3d:"0,1,0,-35deg",transformOrigin:"left center"}).each(function(a,c){setTimeout(function(){$(c).transition({opacity:1,perspective:"100px",rotate3d:"0,1,0,0deg",duration:1E3,easing:"easeOutExpo"},function(){$(this).css({transformOrigin:"50% 50%"})})},b);b=b+400});this.trigger("headerMenuRendered")}});
app.views.footerPlayer=Backbone.View.extend({initialize:function(){this.template=_.template($("#tmp_footer_player").html());this.vars={};this.vars.index=0;this.render();this.collection.fetch();this.collection.on("reset",this.updatePlayer,this)},updatePlayer:function(){this.loadAudioFile();app.config.musicPlayerAutoplay&&this.play()},loadAudioFile:function(a){a=a===void 0?this.vars.index:a;if(isFinite(a)){this.vars.index=Math.abs(parseInt(a));var b=this.$el.find("audio"),a=this.collection.models[a],
c=a.get("formats"),d;Modernizr.audio.ogg&&_.indexOf(c,"ogg")>=0?d="ogg":Modernizr.audio.mp3&&_.indexOf(c,"mp3")>=0&&(d="mp3");if(d){this.vars.path=app.config.musicPath+"/"+d+"/"+a.get("file")+"."+d;b.attr("src",this.vars.path)}}},play:function(){this.$el.find("audio")[0].play();var a=this.vars.index,b=this;this.$el.find("div span").transition({duration:200,opacity:0,queue:false,easing:"easeOutExpo"},function(){$(this).css({}).text(b.collection.models[a].get("title")).transition({duration:500,opacity:1,
queue:false,easing:"easeOutExpo"})})},pause:function(){this.$el.find("audio")[0].pause();this.$el.find("div span").transition({duration:200,opacity:0.5,queue:false,easing:"easeOutExpo"})},rewind:function(){this.vars.index--;if(this.vars.index<0)this.vars.index=this.collection.models.length-1;this.loadAudioFile();this.play()},forward:function(){this.vars.index++;if(this.vars.index==this.collection.models.length)this.vars.index=0;this.loadAudioFile();this.play()},render:function(){var a=this.template({}),
b=this.options.mainView,c=this;b.els.footer.find("#footer-player")&&b.els.footer.remove("#footer-player");b.els.footer.find("#footer-text").before(a);a=b.els.footer.find("#footer-player");this.el=a[0];this.$el=a;this.$el.find("audio").bind("ended",function(){c.forward()});this.$el.find("#footer-player-play").bind("click",function(){c.play()});this.$el.find("#footer-player-pause").bind("click",function(){c.pause()});this.$el.find("#footer-player-rewind").bind("click",function(){c.rewind()});this.$el.find("#footer-player-forward").bind("click",
function(){c.forward()})}});
app.views.ico=Backbone.View.extend({el:"#ico-fullscreen",initialize:function(){this.$el.bind("mouseover",this.over);this.$el.bind("mouseout",this.out);this.$el.bind("mousedown",this.down);this.on("toggleFullscreen",function(){this.$el.transition({right:app_mainView.fullscreen?35:21,top:app_mainView.fullscreen?28:21,duration:400,queue:false,easing:"easeOutExpo"})},this)},over:function(){$(this).transition({opacity:0.8,rotate:"90deg",duration:400,queue:false,easing:"easeOutExpo"})},out:function(){$(this).transition({opacity:1,
scale:1,rotate:"0deg",duration:400,queue:false,easing:"easeOutExpo"})},down:function(){$(this).transition({opacity:0.6,scale:$.browser.mozilla?1:0.9,rotate:"180deg",duration:400,queue:false,easing:"easeOutExpo"},function(){$(this).trigger("mouseout")})}});
app.views.sectionPage=Backbone.View.extend({el:"#section-container",initialize:function(){this.render();return this},events:{"click #section-close":function(){this.close();this.on("sectionClosed",function(){app_router.navigate("#/")})}},close:function(){var a=this;this.$("#section-page").transition({duration:750,easing:"easeOutExpo",queue:false,perspective:300,rotate3d:"0,1,0,-1deg",opacity:0},function(){$(this).remove();a.trigger("sectionClosed");a.off();a.model.off(null,null,this)});this.$("#menu-page").transition({duration:750,
easing:"easeOutExpo",queue:false,opacity:0},function(){$(this).remove()})},render:function(){var a=_.template($("#tmp_section_page").html()),b=this,c=this.model.get("position")===void 0?"left":b.model.get("position");this.$el.html(a({title:this.model.get("title"),subtitle:this.model.get("subtitle"),image:this.model.get("image"),content:this.model.get("content"),subPages:this.model.get("menu")?app_pages.subPages(b.model.id):null,width:this.model.get("width")===void 0?"default":b.model.get("width"),
position:c}));var d=this.$("#menu-page");d.find("a").css({opacity:0,transformOrigin:c=="right"?"right center":"left center",perspective:200,rotate3d:c=="right"?"0,1,0,15deg":"0,1,0,-15deg"});app.utils.fadeImage(this.$el.find("img"));app.utils.scrollbar(this.$el.find("#section-page"));this.$("#section-page").css({opacity:0,transformOrigin:c=="right"?"right center":"left center",perspective:300,rotate3d:c=="right"?"0,1,0,1deg":"0,1,0,-1deg"}).transition({duration:1500,easing:"easeOutExpo",queue:false,
rotate3d:"0,0,0,0deg",opacity:1},function(){b.trigger("sectionOpened");if(d.length){var a=0;d.find("a").each(function(b,c){a=a+350;setTimeout(function(){$(c).transition({opacity:1,duration:350,rotate3d:"0,0,0,0deg"})},a)})}})}});
app.views.sectionVideo=Backbone.View.extend({el:"#section-container",initialize:function(){this.render();this.on("toggleFullscreenStart",this.fullScreenStart,this).on("toggleFullscreenEnd",this.fullScreenEnd,this);return this},fullScreenStart:function(){var a=this;if(app_mainView.fullscreen){this.$("#section-videofull-wrapper").find("iframe").remove();this.$("#section-videofull-wrapper").transition({duration:750,easing:"easeOutExpo",queue:false,scale:0.9,opacity:0},function(){$(this).remove();a.render()})}},
fullScreenEnd:function(){var a=this;app_mainView.fullscreen&&this.$("#section-video-wrapper").transition({duration:750,easing:"easeOutExpo",queue:false,scale:1.1,opacity:0},function(){$(this).remove();a.renderFullScreen()})},events:{"click #section-close":function(){this.close();this.on("sectionClosed",function(){app_router.navigate("#/")})}},close:function(){var a=this;this.$("#section-video-wrapper").transition({duration:750,easing:"easeOutExpo",queue:false,scale:1.1,opacity:0},function(){$(this).remove();
a.trigger("sectionClosed");a.off();a.model.off(null,null,this)})},render:function(){var a=_.template($("#tmp_section_video").html()),b=this;this.$el.html(a({title:this.model.get("title"),subtitle:this.model.get("subtitle"),video_type:this.model.get("video_type"),video_id:this.model.get("video_id"),youtube_theme:this.model.get("youtube_theme")?this.model.get("youtube_theme"):"dark"}));this.$("#section-video-wrapper").css({opacity:0,transformOrigin:"center center",scale:1.25}).transition({duration:1500,
easing:"easeOutExpo",queue:false,scale:1,opacity:1},function(){b.trigger("sectionOpened")})},renderFullScreen:function(){var a=_.template($("#tmp_section_video_fullscreen").html()),b=this;this.$el.html(a({title:this.model.get("title"),subtitle:this.model.get("subtitle"),video_type:this.model.get("video_type"),video_id:this.model.get("video_id"),youtube_theme:this.model.get("youtube_theme")?this.model.get("youtube_theme"):"dark"}));this.$("#section-videofull-wrapper").css({opacity:0,transformOrigin:"center center",
scale:0.9}).transition({duration:1500,easing:"easeOutExpo",queue:false,scale:1,opacity:1},function(){b.trigger("sectionOpened")})}});
app.views.sectionCollection=Backbone.View.extend({el:"#section-container",initialize:function(){this.vars={};var a=this.model.get("collection_id");if(isFinite(a)){if(!app.vars.collections)app.vars.collections={};if(app.vars.collections[a])this.render();else{app.vars.collections[a]=new app.collections.collection(null,{id:a});app.vars.collections[a].on("reset",function(){this.render()},this);app.vars.collections[a].fetch()}}},close:function(){var a=this,b=0;_.each(a.vars.boxesRandom,function(c,d){setTimeout(function(){$(c).transition({opacity:0,
scale:1.25,duration:250,easing:"easeInOutQuart",queue:false},function(){if(d===a.vars.boxesRandom.length-1){a.$el.empty();a.trigger("sectionClosed");a.off();a.model.off(null,null,this)}})},b);b=b+100})},render:function(){var a=_.template($("#tmp_section_collection").html()),b=this.model.get("collection_id");this.$el.html(a({collection:app.vars.collections[b]}));for(var a=this.$el.find(".collection-box"),c=this.$el.find("#section-collection"),b=[],d=[],e,f=0;d.length<a.length;){e=Math.floor(Math.random()*
a.length);if(d.indexOf(e)===-1){d.push(e);b.push(a[e])}}this.vars.boxesRandom=b;app.utils.scrollbar(this.$el.find("#section-collection-container"));a.css({opacity:0,scale:1.2});app.utils.fadeImage(this.$el.find("img"),function(){c.isotope("reLayout")});_.each(b,function(a){setTimeout(function(){$(a).transition({scale:1,opacity:1,duration:550,easing:"easeInOutQuart",queue:false},function(){$(this).addClass("collection-box-transition")})},f);f=f+150});c.isotope({itemSelector:".collection-box",layoutMode:"masonry"});
$(".collection-box-image").bind("click",function(){var a=$(this).find("img"),b=a.parent().parent(),d=parseInt(a.attr("data-zoom"));if(isFinite(d)){var e=a.width(),f=a.height(),d=e===210?e*d:e/d,k=a.height()*(d/e);b.transition({width:d,height:k});a.css({width:e,height:f}).transition({width:d,height:k},function(){c.isotope("reLayout")})}})}});
app.views.sectionGallery=Backbone.View.extend({el:"#section-container",initialize:function(){this.template=_.template($("#tmp_section_gallery").html());this.vars={};var a=this.model.get("gallery_id");if(isFinite(a)){if(!app.vars.galleries)app.vars.galleries={};if(app.vars.galleries[a])this.render();else{app.vars.galleries[a]=new app.collections.gallery(null,{id:a});app.vars.galleries[a].on("reset",function(){this.render()},this);app.vars.galleries[a].fetch()}}app_mainView.on("toggleFullscreenStart",
function(){var a=app_mainView.fullscreen?1:0;$("#ico-right, #ico-left").css({display:"block"}).transition({opacity:a,easing:"easeInOutQuart",duration:750},function(){a==0&&$(this).css("display","none")})},this)},close:function(){var a=this;this.$el.find("#section-gallery-image").transition({opacity:0,scale:0.95,easing:"easeInOutQuart",duration:350},function(){setTimeout(function(){a.$el.find("#section-gallery-thumbs").transition({opacity:0,scale:0.9,easing:"easeInOutQuart",duration:350},function(){a.$el.empty();
a.trigger("sectionClosed");a.off()})},300)});$("#ico-right, #ico-left").transition({opacity:0,easing:"easeInOutQuart",duration:750},function(){$(this).css({display:"none"})});$("#ico-right, #ico-left").off(".gallery")},switchImage:function(a){var b=this,c=this.model.get("gallery_id"),d=app.vars.galleries[c].get(a),e=this.$el.find("#section-gallery-thumbs-bar img[data-id="+a+"]");this.$el.find("#section-gallery-thumbs-bar img").removeClass("section-gallery-thumbs-sel");e.addClass("section-gallery-thumbs-sel");
var a=this.$el.find("#section-gallery-thumbs").width(),c=e.position().left,e=c+parseInt(e.css("margin-left"))+e.width(),f=this.$el.find("#section-gallery-thumbs-bar");if(parseInt(f.css("left"))+c<0){c=parseInt(f.css("left"))+(parseInt(f.css("left"))+c)*-1;f.transition({left:c,easing:"easeInOutQuart",duration:500})}e>a&&f.transition({left:(e-a)*-1-7,easing:"easeInOutQuart",duration:500});this.$el.find("#section-gallery-image-content img").transition({opacity:0,duration:250,easing:"easeInOutQuart"},
function(){var a=$(this).parent();$(this).remove();var c=_.template($("#tmp_section_gallery_image").html())({image:d});a.append(c);a=b.$el.find("#section-gallery-image-content img");a.css("opacity",0);app.utils.fadeImage(a,null,function(){b.vars.stop=false})})},render:function(){var a=this,b=this.model.get("gallery_id");this.$el.html(this.template());var c=this.$el.find("#section-gallery-thumbs-bar"),d=this.$el.find("#section-gallery-image-content"),e=$("#ico-right, #ico-left");e.css({display:"block",
opacity:0}).transition({opacity:1,easing:"easeInOutQuart",duration:750});e.on("click.gallery",function(){if(!a.vars.stop){var b;b=$(this).attr("id").replace(/ico\-/,"")=="left"?a.$el.find("#section-gallery-thumbs-bar img[data-id="+a.vars.imageId+"]").prev():a.$el.find("#section-gallery-thumbs-bar img[data-id="+a.vars.imageId+"]").next();if(b.length){a.vars.stop=true;b=b.attr("data-id");a.vars.imageId=b;a.switchImage(b)}}});var f;app.vars.galleries[b].each(function(a){f=_.template($("#tmp_section_gallery_thumb").html())({image:a});
c.append(f)});app.utils.fadeImage(this.$el.find("#section-gallery-thumbs img"),function(b){$(b).on("click",function(){var b=$(this).attr("data-id");if(b!==a.vars.imageId){a.vars.imageId=b;a.switchImage(b)}})},function(){var b=0,c=a.$el.find("#section-gallery-thumbs-bar");c.find("img").each(function(a,c){b=b+($(c).width()+parseInt($(c).css("margin-left")))});c.width(b)});this.$el.find("#section-gallery-thumbs").css({opacity:0,scale:1.1});this.$el.find("#section-gallery-image").css({opacity:0,scale:1.1});
this.$el.find("#section-gallery-thumbs").transition({opacity:1,scale:1,easing:"easeInOutQuart",duration:350},function(){setTimeout(function(){a.$el.find("#section-gallery-image").transition({opacity:1,scale:1,easing:"easeInOutQuart",duration:350})},300)});if(app.vars.galleries[b].length){c.find("img:eq(0)").addClass("section-gallery-thumbs-sel");b=app.vars.galleries[b].models[0];e=_.template($("#tmp_section_gallery_image").html())({image:b});a.vars.imageId=b.get("id");d.empty().append(e);app.utils.fadeImage(this.$("#section-gallery-image img"))}}});
app.views.sectionBlog=Backbone.View.extend({el:"#section-container",events:{"click #section-close":function(){this.close();this.on("sectionClosed",function(){app_router.navigate("#/")})}},initialize:function(){var a=this.model.get("blog_id");if(isFinite(a)){if(!app.vars.blogs)app.vars.blogs={};if(app.vars.blogs[a])this.render();else{app.vars.blogs[a]=new app.collections.blog(null,{id:a});app.vars.blogs[a].on("reset",function(){this.render()},this);app.vars.blogs[a].fetch()}}},close:function(){var a=
this;this.$("#section-page").transition({duration:750,easing:"easeOutExpo",queue:false,perspective:300,rotate3d:"0,1,0,-1deg",opacity:0},function(){$(this).remove();a.trigger("sectionClosed");a.off();a.model.off(null,null,this)});this.$("#menu-page").transition({duration:750,easing:"easeOutExpo",queue:false,opacity:0},function(){$(this).remove()})},render:function(){var a=_.template($("#tmp_section_blog").html()),b=this,c=this.model.get("blog_id"),d=this.model.get("position")===void 0?"left":b.model.get("position");
this.$el.html(a({subPages:this.model.get("menu")?app_pages.subPages(this.model.id):null,title:this.model.get("title"),subtitle:this.model.get("subtitle"),posts:app.vars.blogs[c],page:this.model,width:this.model.get("width")===void 0?"default":b.model.get("width"),position:d}));var e=this.$el.find(".post-list");app.utils.scrollbar(this.$el.find("#section-page"));e.css({opacity:0});app.utils.fadeImage(this.$("#section-page img"));this.$("#section-page").css({opacity:0,transformOrigin:d=="right"?"right center":
"left center",perspective:300,rotate3d:d=="right"?"0,1,0,1deg":"0,1,0,-1deg"}).transition({duration:1500,easing:"easeOutExpo",queue:false,rotate3d:"0,0,0,0deg",opacity:1},function(){b.trigger("sectionOpened");app.utils.fadeImage($(".post-list img"));var a=350;e.each(function(b,c){setTimeout(function(){$(c).css({scale:0.95}).transition({opacity:1,scale:1,easing:"easeOutExpo",duration:500})},a);a=a+350})})}});
app.views.sectionBlogPost=Backbone.View.extend({el:"#section-container",initialize:function(){var a=this.model.get("id"),b=app_router.vars.id;this.vars={};if(isFinite(a)&&isFinite(b)){b=app_pages.get(b);this.vars.position=b.get("position");this.vars.width=b.get("width");if(!app.vars.comments)app.vars.comments={};if(app.vars.comments[a])this.renderCommentsList();else{app.vars.comments[a]=new app.collections.comments(null,{id:a});app.vars.comments[a].on("reset",this.renderCommentsList,this);app.vars.comments[a].fetch()}}this.render()},
events:{"click #section-close":function(){this.close();this.on("sectionClosed",function(){app_router.navigate("#/")})},"click #section-back":function(){var a=app_pages.get(app_router.vars.id);app_router.navigate("#/"+a.get("id")+"/"+a.get("url"))}},close:function(){var a=this;this.$("#section-page").transition({duration:750,easing:"easeOutExpo",queue:false,perspective:300,rotate3d:"0,1,0,-1deg",opacity:0},function(){$(this).remove();a.trigger("sectionClosed");a.off();a.model.off(null,null,this)})},
renderCommentsList:function(){var a=this.model.get("id"),a=_.template($("#tmp_section_commentslist").html())({comments:app.vars.comments[a].models}),b=0;this.$el.find("#section-page-content-commentslist").empty().append(a).find("li").css({opacity:0}).each(function(a,d){setTimeout(function(){$(d).transition({opacity:1,duration:500,easing:"easeOutExpo",queue:false})},b);b=b+500})},render:function(){var a=_.template($("#tmp_section_blog_post").html()),b=this,c=this.vars.position===void 0?"left":this.vars.position;
this.$el.html(a({subPages:null,title:this.model.get("title"),subtitle:this.model.get("subtitle"),image:this.model.get("image"),post:this.model,displayComments:this.model.get("comments")===void 0?true:this.model.get("comments"),width:this.vars.width===void 0?"default":this.vars.width,position:c}));app.utils.scrollbar(this.$el.find("#section-page"));app.utils.fadeImage(this.$("#section-page img"));this.$("#section-page").css({opacity:0,transformOrigin:c==="right"?"right center":"left center",perspective:300,
rotate3d:c==="right"?"0,1,0,1deg":"0,1,0,-1deg"}).transition({duration:1500,easing:"easeOutExpo",queue:false,rotate3d:"0,0,0,0deg",opacity:1},function(){b.trigger("sectionOpened")})}});app.models.post=Backbone.Model.extend({});app.models.collectionElement=Backbone.Model.extend({});app.models.page=Backbone.Model.extend({});app.models.music=Backbone.Model.extend({});app.models.comment=Backbone.Model.extend({});app.models.image=Backbone.Model.extend({});
app.collections.pages=Backbone.Collection.extend({model:app.models.page,url:app.config.pagesJsonUrl,rootPages:function(){return _.filter(this.models,function(a){return!isFinite(a.get("parent_id"))&&a.get("hidden")!==true})},subPages:function(a){return isFinite(a)?_.filter(this.models,function(b){return b.get("parent_id")==a}):_.filter(this.models,function(a){return isFinite(a.get("parent_id"))})}});
app.collections.blog=Backbone.Collection.extend({model:app.models.post,url:app.config.blogJsonUrl,initialize:function(a,b){var c=b.id;if(this.url.indexOf(":id")>0&&isFinite(c))this.url=this.url.replace(/\:id/,encodeURIComponent(c))}});app.collections.collection=Backbone.Collection.extend({model:app.models.collectionElement,url:app.config.collectionJsonUrl,initialize:function(a,b){var c=b.id;if(this.url.indexOf(":id")>0&&isFinite(c))this.url=this.url.replace(/\:id/,encodeURIComponent(c))}});
app.collections.playlist=Backbone.Collection.extend({model:app.models.music,url:app.config.playlistJsonUrl});app.collections.comments=Backbone.Collection.extend({model:app.models.comment,url:app.config.commentsJsonUrl,initialize:function(a,b){var c=b.id;if(this.url.indexOf(":id")>0&&isFinite(c))this.url=this.url.replace(/\:id/,encodeURIComponent(c))}});
app.collections.gallery=Backbone.Collection.extend({model:app.models.image,url:app.config.galleryJsonUrl,initialize:function(a,b){var c=b.id;if(this.url.indexOf(":id")>0&&isFinite(c))this.url=this.url.replace(/\:id/,encodeURIComponent(c))}});var app_router,app_mainView,app_pages,app_playlist;$(function(){app_router=new app.router;app_pages=new app.collections.pages;app_mainView=new app.views.main;app_router.navigate("#/");Backbone.history.start()});